{"version":3,"file":"index-9f3Jlh5w.js","sources":["../../src/views/example/custom/index.ts","../../src/views/example/custom/index.vue"],"sourcesContent":["import { debounce } from 'lodash'\r\n\r\nimport type { BaseRow, ColumnsType, Fields, Props } from '@/components/A-Crud/'\r\nimport { InitCrudOptions, ReDeleteFlag, ReRadioGroup, ReSelect } from '@/components/A-Crud/'\r\n\r\nimport { type KeysOf, type MapValueType, type ResultType, SystemParamsStore } from '@/stores'\r\nimport { Http, type ResponseData } from '@/utils/http'\r\n\r\ninterface Row extends BaseRow {\r\n    /** 用户ID */\r\n    userId: number\r\n    /** 用户名 */\r\n    userName: string\r\n    /** 用户密码 */\r\n    password: string\r\n    /** 加盐md5算法中的盐 */\r\n    // salt: '2022-01-01 00:00:00'\r\n    /** 用户类型，1-系统管理员、2-公司内部用户、3-外部用户 */\r\n    userType: number\r\n    /** 组织机构ID */\r\n    orgId: number\r\n    /** 组织名称 */\r\n    orgName: string\r\n    /** 真实姓名 */\r\n    realName: string\r\n    /** Email */\r\n    email: string\r\n    /** 手机号码 */\r\n    phoneNumber: string\r\n    /** 性别，1-无值、2-男、3-女、4-其它 */\r\n    sex: number\r\n    /** 生日 */\r\n    birth: string | null\r\n    /** 身份证号码 */\r\n    idNo: string\r\n    /** 微信小程序的openid */\r\n    openId: string\r\n    /** 微信公众号openid */\r\n    woaOpenid: string\r\n    /** 备注 */\r\n    remark: string\r\n    /** url根部信息，如：https://abc.com/ */\r\n    photoUrlRoot: string\r\n    /** 图片存储路径，如：/images/abc/xxx.jpg */\r\n    photoPath: string\r\n    /** 操作人账号 */\r\n    // operatorName: string\r\n    /** 记录删除标记，0-正常、1-禁用 */\r\n    // deleteFlag: 0\r\n    /** 创建时间 */\r\n    // createTime: string\r\n    /** 更新时间 */\r\n    // updateTime: string\r\n}\r\n\r\nconst columns: ColumnsType<Row> = reactive({\r\n    index: {\r\n        type: markRaw({}),\r\n        label: '序号',\r\n        tableProps: { type: 'index', width: '55', align: 'right' },\r\n        render: ({ $index, crudOptions }) => {\r\n            const { TableStore: { page: { currentPage, pageSize } } } = crudOptions\r\n            const indexMethod = computed(() => (currentPage.value - 1) * pageSize.value + 1)\r\n            return h('span', null, indexMethod.value + $index)\r\n        },\r\n    },\r\n    userId: {\r\n        type: markRaw({}),\r\n        label: '用户ID',\r\n        tableProps: { width: 70, align: 'right' },\r\n    },\r\n    userName: {\r\n        type: markRaw(ElInput),\r\n        label: '用户名',\r\n        tableProps: { width: 120 },\r\n    },\r\n    password: {\r\n        type: markRaw(ElInput),\r\n        label: '用户密码',\r\n    },\r\n    userType: {\r\n        type: markRaw(ReSelect),\r\n        label: '用户类型',\r\n        componentProps: { options: [], isButton: true },\r\n    },\r\n    orgId: {\r\n        type: markRaw(ReSelect),\r\n        label: '组织机构ID',\r\n        componentProps: {\r\n            options: [],\r\n            filterable: true,\r\n            remote: true,\r\n            loading: false,\r\n            loadingText: '查询中，耐心等待...',\r\n            onRemoteMethod: (query: string) => {\r\n                const componentProps = columns.orgId.componentProps!\r\n                componentProps.loading = true\r\n\r\n                Http.CrudRequest<{ orgFullname: string, orgId: number }[]>({\r\n                    // url: '/orgnization/query',\r\n                    url: '/user/query',\r\n                    data: { orgName: query, deleteFlag: 0 },\r\n                }).then((Res) => {\r\n                    componentProps.options = Res.data.map((item) => {\r\n                        return { label: item.orgFullname, value: item.orgId }\r\n                    })\r\n                }).finally(() => {\r\n                    componentProps.loading = false\r\n                })\r\n            },\r\n        },\r\n    },\r\n    orgName: {\r\n        type: markRaw(ElInput),\r\n        label: '组织名称',\r\n    },\r\n    realName: {\r\n        type: markRaw(ElInput),\r\n        label: '真实姓名',\r\n    },\r\n    email: {\r\n        type: markRaw(ElInput),\r\n        label: 'Email',\r\n    },\r\n    phoneNumber: {\r\n        type: markRaw(ElInput),\r\n        label: '手机号码',\r\n        tableProps: { minWidth: 120 },\r\n    },\r\n    sex: {\r\n        type: markRaw(ReSelect),\r\n        label: '性别',\r\n        componentProps: { options: [] },\r\n    },\r\n    birth: {\r\n        type: markRaw(ElInput),\r\n        label: '生日',\r\n    },\r\n    idNo: {\r\n        type: markRaw(ElInput),\r\n        label: '身份证号码',\r\n    },\r\n    openId: {\r\n        type: markRaw(ElInput),\r\n        label: '小程序的openid',\r\n    },\r\n    woaOpenid: {\r\n        type: markRaw(ElInput),\r\n        label: '公众号openid',\r\n    },\r\n    remark: {\r\n        type: markRaw(ElInput),\r\n        label: '备注',\r\n    },\r\n    photoUrlRoot: {\r\n        type: markRaw(ElInput),\r\n        label: 'url根',\r\n    },\r\n    photoPath: {\r\n        type: markRaw(ElInput),\r\n        label: '图片路径',\r\n    },\r\n    operatorName: {\r\n        type: markRaw(ElInput),\r\n        label: '操作人账号',\r\n    },\r\n    deleteFlag: {\r\n        type: markRaw(ReRadioGroup),\r\n        label: '状态',\r\n        searchDefaultValue: 0,\r\n        componentProps: { options: [], isButton: true },\r\n        tableProps: { width: 70, align: 'center' },\r\n        render: ({ row }) => {\r\n            return h(\r\n                ReDeleteFlag,\r\n                {\r\n                    'size': 'small',\r\n                    'modelValue': row.deleteFlag,\r\n                    'onUpdate:modelValue': (newValue) => { row.deleteFlag = newValue },\r\n                },\r\n            )\r\n        },\r\n    },\r\n    createTime: {\r\n        type: markRaw(ElInput),\r\n        label: '创建时间',\r\n    },\r\n    updateTime: {\r\n        type: markRaw(ElInput),\r\n        label: '更新时间',\r\n    },\r\n})\r\n\r\nconst fields: Fields<Row> = {\r\n    filter: ['orgId', 'orgName', 'userName', 'userType', 'realName', 'phoneNumber', 'sex', 'deleteFlag'],\r\n    editor: ['userName', 'password', 'userType', 'orgId', 'orgName', 'realName', 'email', 'phoneNumber', 'sex', 'birth', 'idNo', 'openId', 'woaOpenid', 'remark'],\r\n    column: ['index', 'userId', 'userName', 'userType', 'orgId', 'orgName', 'realName', 'phoneNumber', 'sex', 'deleteFlag'],\r\n    expand: ['index', 'userId', 'userName', 'password', 'userType', 'orgId', 'orgName', 'realName', 'email', 'phoneNumber', 'sex', 'birth', 'idNo', 'openId', 'woaOpenid', 'remark', 'photoUrlRoot', 'photoPath', 'operatorName', 'deleteFlag', 'createTime', 'updateTime'],\r\n}\r\n// console.log(fields.expand)\r\n\r\nconst attributes: Props<Row> = {\r\n    apiConfig: {\r\n        url: 'user',\r\n        rowKey: 'userId',\r\n    },\r\n    source: { fields, columns },\r\n    attrs: {\r\n        form: {\r\n            // labelWidth: '120px',\r\n        },\r\n        drawer: {\r\n            // showClose: false,\r\n        },\r\n        table: {\r\n            // height: 800,\r\n        },\r\n    },\r\n    hooks: {\r\n        // beforeQueryHandler: ({ searchForm, formData }) => {\r\n        //     console.log(searchForm)\r\n        //     console.log(formData.value)\r\n\r\n        //     return true\r\n        // },\r\n    },\r\n}\r\n\r\nconst crudOptions = InitCrudOptions<Row>(attributes.source, attributes.apiConfig, attributes.hooks)\r\n\r\n// const ParamsMap = new Map<KeysOf<Row>, MapValueType>([\r\n//     ['deleteFlag', { key: 'delete_flag' }],\r\n//     ['userType', { key: 'user_type', disabled: item => item.itemId === 1 }],\r\n//     ['sex', { key: 'sex', value: item => item.itemId, label: item => item.itemValue, disabled: item => item.itemId === 1 }],\r\n// ])\r\n// const Params: Partial<Record<KeysOf<Row>, ResultType[]>> = reactive({})\r\n\r\n// SystemParamsStore().GetSystemParams(ParamsMap).then((Res) => {\r\n//     Res.forEach((value, key) => {\r\n//         Params[key] = value\r\n//         if (columns[key]?.componentProps && columns[key].componentProps?.options)\r\n//             columns[key].componentProps.options = value\r\n//         else\r\n//             console.warn(`columns 中 ${key} 未找到 componentProps.options 配置`)\r\n//     })\r\n// })\r\n\r\n// const { FormStore: { searchForm } } = crudOptions\r\n\r\n// watch(() => searchForm.orgId, (orgId) => {\r\n//     console.log(orgId)\r\n\r\n//     Http.CrudRequest({\r\n//         url: 'teachingPlan/getItems',\r\n//         data: { orgId, deleteFlag: 0 },\r\n//     }).then((Res) => {\r\n//         console.log(Res)\r\n//     })\r\n// }, { deep: true })\r\n\r\nexport { attributes, crudOptions }\r\n","<script setup lang=\"ts\">\r\nimport { attributes, crudOptions } from '.'\r\nimport { CrudActionArea, CrudDrawer, CrudSearchForm, CrudTable } from '@/components/A-Crud'\r\n\r\nconst { FormStore: { searchForm, editForm } } = crudOptions\r\n</script>\r\n\r\n<template>\r\n    <div id=\"ElCrud\" class=\"rounded-10 bg-[var(--el-bg-color)] p-20\">\r\n        <CrudDrawer v-model=\"editForm\" :crud-options=\"crudOptions\" :attrs=\"attributes.attrs\" />\r\n        <CrudSearchForm v-model=\"searchForm\" :crud-options=\"crudOptions\" :attrs=\"attributes.attrs\" />\r\n\r\n        <CrudActionArea :crud-options=\"crudOptions\" />\r\n\r\n        <CrudTable :crud-options=\"crudOptions\" :attrs=\"attributes.attrs\" />\r\n    </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n\r\n</style>\r\n"],"names":["columns","reactive","markRaw","$index","crudOptions","currentPage","pageSize","indexMethod","computed","h","ElInput","ReSelect","query","componentProps","Http","Res","item","ReRadioGroup","row","ReDeleteFlag","newValue","fields","attributes","InitCrudOptions","searchForm","editForm"],"mappings":"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"}